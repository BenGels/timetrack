<!DOCTYPE html>

<html lang="de">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Zeittabelle - wann komme ich, wann gehe ich?</title>
	<meta name="author" content="">
	<link href="css/style.css" media="screen" rel="stylesheet" type="text/css">
	<?php if($mobiledevice) : ?>
		<meta name="viewport" content="width=320; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;"/>
		<link href="css/style.handheld.css" rel="stylesheet" type="text/css">		
	<?php endif; ?>	
	<link rel="shortcut icon" href="img/favicon.ico" />
	<link rel="icon" href="img/favicon.ico" type="image/ico" />
	<link rel="stylesheet" type="text/css" href="js/SqueezeBox/assets/SqueezeBox.css">
</head>
<body>
<div id="month_navigator">
	<div id="action_menu">
		<ul>
		<li>
		<a href="#" id="changeuserdata_action_link">Logindaten ändern</a>
		<div id="changeuserdata_widow" class="settings_popdown">
			<form action="<?php echo dirname($_SERVER["SCRIPT_NAME"]) ?>/action.php" method="POST" autocomplete="off">
				<input type="hidden" name="action"  value="changeuserdata">
				Username:<br>
				<?php if(isset($username)) : ?>
					<strong><?php echo $username; ?></strong>
					<input type="hidden"id="changeuserdata_user" name="changeuserdata_user"  value="<?php echo $username; ?>">
				<?php else : ?>
					<input type="text" id="changeuserdata_user" name="changeuserdata_user" value="">
				<?php endif; ?>
				<br>
				Passwort:<br>
				<input type="password" id="changeuserdata_pass" name="changeuserdata_pass">

				<input type="submit">
			</form>
		</div>
		</li>

		<li>
		<a href="#" id="correct_action_link">Korrigieren</a>
		<div id="correct_widow" class="settings_popdown">
			<form action="<?php echo $_SERVER["SCRIPT_NAME"] ?>" method="get">
			Korrektur in Minuten:
			<input type="text" id="correction_value" name="correction_value">
			Korrigierte Differenz:
			<input type="text" id="correction_absolute" name="correction_absolute">

			<input type="submit">
			</form>
		</div>
		</li>
		</ul>
	</div>
	
	<div id="months">
		<ul>
		<?php foreach($data['months'] as $month=>$time): ?>
			<li>
				<a href="<?php echo $_SERVER["SCRIPT_NAME"] ?>?m=<?php echo $month ?>" class="<?php echo ($month==$curmonth ? 'active' : '') ?>"><?php echo formatmonth($month) ?></a>
			</li>
		<?php endforeach; ?>
		</ul>
	</div>
</div>

<div id="overview">
	<div id="day_diff" class="">
		<span class="diff_label">Ankunft:</span><br>
		<?php echo date("G:i:s", $day['startstamp']) ?>
	</div>
	
	<div id="day_diff" class="">
		<span class="diff_label">Pause:</span><br>
		<?php echo gmdate("G:i:s", $day['pause']) ?>
	</div>
	
	<div id="day_diff" class="">
		<span class="diff_label">Feierabend:</span><br>
		<?php echo date("G:i:s", $day['startstamp']+$day['pause']+60*60*8.75) ?>
	</div>

	<?php if ($day['diff']>0): ?>
		<div id="day_diff">
			<span class="diff_label">Differenz:</span><br>
			<span id="day_diff_hour">
				<?php echo gmdate("G", $day['diff']) ?>
			</span>:<span id="day_diff_minute">
				<?php echo gmdate("i", $day['diff']) ?>
			</span>:<span id="day_diff_seconds">
				<?php echo gmdate("s", $day['diff']) ?>
			</span>
		</div>
	<?php else:?>
		<div id="day_diff" class="negative">
			<span class="diff_label">Differenz heute:</span><br>
			-<span id="day_diff_hour"><?php echo gmdate("G", $day['diff']*-1) ?></span>:<span id="day_diff_minute"><?php echo gmdate("i", $day['diff']*-1) ?></span>:<span id="day_diff_seconds"><?php echo gmdate("s", $day['diff']*-1) ?></span>
		</div>
	<?php endif; ?>
	
	<?php if ($data['months'][$curmonth]>0): ?>
		<div id="month_diff">
			<span class="diff_label"><?php echo formatmonth($curmonth) ?>:</span><br>
			<?php echo gmdate("G:i:s", $data['months'][$curmonth]) ?>
		</div>
	<?php else:?>
		<div id="month_diff" class="negative">
			<span class="diff_label"><?php echo formatmonth($curmonth) ?>:</span><br>
			-<?php echo gmdate("G:i:s", $data['months'][$curmonth]*-1) ?>
		</div>
	<?php endif; ?>
	<div id="action_field">
		<a href="download.php?h=<?php echo $hash ?>">Daemon downloaden</a><br>
		<a href="index.php">Ausloggen</a>
	</div>
</div>


<div style="overflow:hidden" id="content_wrapper">
	<div class="leftColumn">
	<table>
		<thead>
			<tr>
				<th>Datum</th>
				<th>Anwesenheit</th>
				<th>Länge</th>
				<th>Pause</th>
				<th>Diff.</th>
				<th>Gesamt</th>
			</tr>
		</thead>
		<tbody>
	<?php foreach ($data['days'] as $curday => $cday): ?>
		<?php if ($curmonth==$cday['month']): ?>
			<tr class="<?php echo ($alt=!$alt ? 'alt' : '') ?>">
				<td>
					<a href="correct.php?date=<?php echo $curday ?>" class="correctionLink">
					<strong><?php echo date("d.m.Y",$cday['datestamp'])?></strong>
					</a>
				</td>
				<td>
					<?php echo date("G:i",$cday['startstamp'])?> - <?php echo date("G:i",$cday['endstamp'])?>
				</td>
				<td>
					<?php echo gmdate("G:i",$cday['worktime']) ?>
				</td>
				<td>
				<?php echo gmdate("G:i",$cday['pause']) ?>
				</td>
				<td>
					<?php if ($cday['diff']>=0): ?>
					+<?php echo gmdate("G:i",$cday['diff']) ?>
					<?php else: ?>
					<span class="negative_value">-<?php echo gmdate("G:i",$cday['diff']*-1) ?></span>
					<?php endif; ?>
				</td>
				<td>
				<?php if ($cday['monthdiff']>=0): ?>
					+<?php echo gmdate("G:i",$cday['monthdiff']) ?>
				<?php else: ?>
					<span class="negative_value">-<?php echo gmdate("G:i",$cday['monthdiff']*-1) ?></span>
				<?php endif; ?>
					
				</td>
			</tr>
		<?php endif; ?>
	<?php endforeach; ?>
	</tbody>
	</table>
	</div>

	<div class="rightColumn">
		<img src="<?php echo $timetrack->generatePresenceGraphUrl($curmonth, 'Anwesenheit in Stunden'); ?>">
		<br>
		<img src="<?php echo $timetrack->generateDifferenceGraphUrl($curmonth, 'Differenz zum Soll'); ?>">
		<br>
		<strong>Hash:</strong> 
		<?php if ($timetrack->isWritable()): ?>
			<a href="editor.php" class="editorLink" rel="{handler:'iframe'}" style="color: #fff; text-decoration: none;"><?php echo $timetrack->hash ?></a>
		<?php else: ?>
			<?php echo $timetrack->hash ?>
		<?php endif; ?>
		<br />
		<img src="http://chart.apis.google.com/chart?chs=150x150&cht=qr&chl=<?php echo $timetrack->hash ?>&choe=UTF-8">
	</div>

</div>
<div>
</div>
<script type="text/javascript">
<!--
var day_diff = <?php echo $day['startstamp']+$day['pause']+60*60*8.75 ?>;
-->
</script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/mootools/1.2.1/mootools-yui-compressed.js"></script>
<script type="text/javascript" src="js/mootools-1.2.2.1-more.js"></script>
<script type="text/javascript" src="js/SqueezeBox/SqueezeBox.js"></script>
<script type="text/javascript" src="js/TimeSlider.js"></script>
<script type="text/javascript" src="js/show.js"></script>
</body>
</html>

